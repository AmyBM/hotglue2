$.glue.text=function(){var a=function(e,d,b){if(typeof d!=="string"){if(d.toString){d=d.toString()}else{return""}}if(typeof b!=="string"){if(b.toString){b=b.toString()}else{return""}}var c=0;while(c+e.length<=b.length){if(b.substring(c,c+e.length)==e){b=b.substring(0,c)+d+b.substring(c+e.length);c+=d.length}else{c++}}return b};return{insert_at_cursor:function(d,c){var d=$(d).get(0);var e=d.selectionStart;var b=d.selectionEnd;d.value=d.value.substring(0,e)+c+d.value.substring(b,d.value.length);d.selectionStart=e+c.length;d.selectionEnd=e+c.length},render_content:function(c,b){c=a("$BASEURL$",$.glue.base_url,c);c=a("$baseurl$",$.glue.base_url,c);c=a("$GLUE$",a(",",".",$.glue.version),c);c=a("$glue$",a(",",".",$.glue.version),c);c=a("$OBJ$",b,c);c=a("$obj$",b,c);c=a("$PAGE$",$.glue.page,c);c=a("$page$",$.glue.page,c);c=a("$PAGENAME$",$.glue.page.split(".").slice(0,1),c);c=a("$pagename$",$.glue.page.split(".").slice(0,1),c);c=a("$REV$",$.glue.page.split(".").slice(1,2),c);c=a("$rev$",$.glue.page.split(".").slice(1,2),c);if($.glue.conf.text.auto_br){c=a("\r\n","<br>",c);c=a("\n","<br>",c)}return c}}}();$(".text").live("glue-register",function(a){$(this).children(".glue-text-input").bind("mousedown",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}});$(this).children(".glue-text-input").bind("keydown",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}if(b.which==9){$.glue.text.insert_at_cursor($(this),String.fromCharCode(9));b.preventDefault();return false}else{if(b.shiftKey&&b.which==32){$.glue.text.insert_at_cursor($(this),String.fromCharCode(160));b.preventDefault();return false}}});$(this).children(".glue-text-input").bind("keypress",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}});$(this).children(".glue-text-input").bind("keyup",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}});$(this).children(".glue-text-render").find("a").bind("click",function(b){return false});$(this).children(".glue-text-render").find("a").attr("title","this link is disabled for editing")});$(".text.glue-selected").live("click",function(a){if($(this).hasClass("glue-text-editing")){return}if($(this).hasClass("glue-selected")){$(".glue-selected").not(this).each(function(){$.glue.sel.deselect(this)})}$(this).one("glue-deselect",function(b){if($(this).hasClass("glue-text-editing")){$(this).children(".glue-text-render").html($.glue.text.render_content($(this).children(".glue-text-input").val(),$(this).attr("id")));$(this).removeClass("glue-text-editing");$(this).children(".glue-text-render").find("a").bind("click",function(c){return false});$(this).children(".glue-text-render").find("a").attr("title","this link is disabled for editing");$(this).children(".glue-text-render").find("a").each(function(){var c=$(this).attr("href");if(c.charAt(0)!="#"&&c.indexOf("://")<1){$(this).attr("href",$.glue.base_url+c)}});$(this).children(".glue-text-input").css("display","none");$(this).children(".glue-text-render").css("display","block");$.glue.backend({method:"glue.update_object",name:$(this).attr("id"),content:$(this).children(".glue-text-input").val()})}});$(this).children(".glue-text-input").css("display","block");$(this).children(".glue-text-render").css("display","none");$(this).addClass("glue-text-editing");$(this).children(".glue-text-input").focus();if($(this).children(".glue-text-input").get(0).setSelectionRange){$(this).children(".glue-text-input").get(0).setSelectionRange(0,0)}});$(document).ready(function(){var b=$('<img src="'+$.glue.base_url+'modules/text/text.png" alt="btn" title="add a new text object" width="32" height="32">');$(b).bind("click",function(c){$.glue.backend({method:"glue.create_object",page:$.glue.page},function(f){var e=$('<div class="text resizable object" style="position: absolute;"><textarea class="glue-text-input" style="display: none; height: 100%; width: 100%;"></textarea><div class="glue-text-render" style="height: 100%; width: 100%;"></div></div>');$(e).attr("id",f.name);if($.glue.conf.object.default_colors){var d=Math.floor(Math.random()*$.glue.conf.object.default_colors.length);$(e).css("background-color",$.glue.conf.object.default_colors[d])}$("body").append(e);$(e).css("width",$(e).width()+"px");$(e).css("height",$(e).height()+"px");$(e).css("left",(c.pageX-$(e).outerWidth()/2)+"px");$(e).css("top",(c.pageY-$(e).outerHeight()/2)+"px");$.glue.object.register(e);$.glue.object.save(e)});$.glue.menu.hide()});$.glue.menu.register("new",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-background-color.png" alt="btn" title="change background-color" width="32" height="32">');var a=false;$(b).bind("click",function(f){var d=$(this).data("owner");var c=$(d).css("background-color");if(f.shiftKey){c=prompt("Enter background color (e.g. #ff0000 or rgb(255, 0, 0))",c);if(!c){return}}$.glue.colorpicker.show(c,false,function(e){$(d).css("background-color",e)},function(e){$.glue.object.save(d);a=false});a=true});$(b).bind("glue-deselect",function(c){if(a){$.glue.colorpicker.hide();a=false}});$.glue.contextmenu.register("text","text-background-color",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-background-transparent.png" alt="btn" title="make background transparent" width="32" height="32">');$(b).bind("click",function(d){var c=$(this).data("owner");$(c).css("background-color","transparent");$.glue.object.save(c)});$.glue.contextmenu.register("text","text-background-transparent",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-size.png" alt="btn" title="drag to change font size, click to reset to default one" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$(this).data("owner");$(this).attr("title","drag to change font size ("+$(c).css("font-size")+"), click to reset to default one")});$(b).bind("mousedown",function(h){var g=$(this).data("owner");var c=parseInt($(g).css("font-size"));if(isNaN(c)){c=10}var f=true;var d=this;$.glue.slider(h,function(e,j){var i=Math.floor(c+j/6);if(i<0){i=0}$(g).css("font-size",i+"px");$(d).attr("title","drag to change font size ("+i+"px), click to reset to default one");if(e!=0||j!=0){f=false}},function(e,i){if(f){$(g).css("font-size","");$.glue.backend({method:"glue.object_remove_attr",name:$(g).attr("id"),attr:"text-font-size"});$(d).attr("title","drag to change font size ("+$(g).css("font-size")+"px), click to reset to default one")}else{$.glue.object.save(g)}});return false});$.glue.contextmenu.register("text","text-font-size",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-color.png" alt="btn" title="change font color" width="32" height="32">');$(b).bind("click",function(f){var d=$(this).data("owner");var c=$(d).css("color");if(f.shiftKey){c=prompt("Enter font color (e.g. #ff0000 or rgb(255, 0, 0))",c);if(!c){return}}$.glue.colorpicker.show(c,false,function(e){$(d).css("color",e)},function(e){$.glue.object.save(d);a=false});a=true});$.glue.contextmenu.register("text","text-font-color",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-face.png" alt="btn" title="change typeface (click to cycle through available typefaces)" width="32" height="32">');$(b).bind("click",function(m){var k=$(this).data("owner");var o=[];for(var l=0;l<document.styleSheets.length;l++){var n=document.styleSheets[l];for(var g=0;n.cssRules&&g<n.cssRules.length;g++){var p=n.cssRules[g];if(p.selectorText&&p.selectorText.substr(0,10)==".glue-font"){var r=p.cssText;var c=r.indexOf("font-family:");if(c==-1){continue}c+=12;var f=r.length-1;var h=r.indexOf("}",c);if(h!=-1){f=h-1}h=r.indexOf(";",c);if(h!=-1&&h<f){f=h-1}o.push($.trim(r.substr(c,f-c+1)))}}}var q=$(k).css("font-family");var d=false;for(l=0;l<o.length;l++){if(q===o[l]){if(l+1<o.length){$(k).css("font-family",o[l+1])}else{$(k).css("font-family",o[0])}d=true}}if(!d&&o.length){$(k).css("font-family",o[0]);d=true}if(d){$.glue.object.save(k)}});$.glue.contextmenu.register("text","text-font-face",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-style.png" alt="btn" title="change font style" width="32" height="32">');$(b).bind("click",function(d){var c=$(this).data("owner");if($(c).css("font-style")=="normal"&&($(c).css("font-weight")=="bold"||$(c).css("font-weight")=="700")){$(c).css("font-style","italic");$(c).css("font-weight","normal")}else{if($(c).css("font-style")=="italic"&&($(c).css("font-weight")=="normal"||$(c).css("font-weight")=="400")){$(c).css("font-style","italic");$(c).css("font-weight","bold")}else{if($(c).css("font-style")=="italic"&&($(c).css("font-weight")=="bold"||$(c).css("font-weight")=="700")){$(c).css("font-style","normal");$(c).css("font-weight","normal")}else{$(c).css("font-style","normal");$(c).css("font-weight","bold")}}}$.glue.object.save(c)});$.glue.contextmenu.register("text","text-font-style",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-line-height.png" alt="btn" title="change line height, click to reset to default one" width="32" height="32">');$(b).bind("glue-menu-activate",function(c){});$(b).bind("mousedown",function(i){var h=$(this).data("owner");var c=parseFloat($(h).css("font-size"));if($(h).css("line-height").substr(-2)=="em"){var d=parseFloat($(h).css("line-height"))*c}else{if($(h).css("line-height").substr(-2)=="px"){var d=parseFloat($(h).css("line-height"))}else{var d=c*1.2}}var g=true;var f=this;$.glue.slider(i,function(e,k){var j=d+k/6;if(j<0){j=0}$(h).css("line-height",(j/c)+"em");if(e!=0||k!=0){g=false}},function(e,j){if(g){$(h).css("line-height","");$.glue.backend({method:"glue.object_remove_attr",name:$(h).attr("id"),attr:"text-line-height"})}else{$.glue.object.save(h)}});return false});$.glue.contextmenu.register("text","text-line-height",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-letter-spacing.png" alt="btn" title="change letter spacing" width="32" height="32">');$(b).bind("glue-menu-activate",function(c){});$(b).bind("mousedown",function(i){var h=$(this).data("owner");var c=parseFloat($(h).css("font-size"));if($(h).css("letter-spacing").substr(-2)=="em"){var d=parseFloat($(h).css("letter-spacing"))*c}else{if($(h).css("letter-spacing").substr(-2)=="px"){var d=parseFloat($(h).css("letter-spacing"))}else{var d=0}}var g=true;var f=this;$.glue.slider(i,function(e,k){var j=d+k/6;$(h).css("letter-spacing",(j/c)+"em");if(e!=0||k!=0){g=false}},function(e,j){if(g){$(h).css("letter-spacing","");$.glue.backend({method:"glue.object_remove_attr",name:$(h).attr("id"),attr:"text-letter-spacing"})}else{$.glue.object.save(h)}});return false});$.glue.contextmenu.register("text","text-letter-spacing",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-word-spacing.png" alt="btn" title="change word spacing" width="32" height="32">');$(b).bind("glue-menu-activate",function(c){});$(b).bind("mousedown",function(i){var h=$(this).data("owner");var c=parseFloat($(h).css("font-size"));if($(h).css("word-spacing").substr(-2)=="em"){var d=parseFloat($(h).css("word-spacing"))*c}else{if($(h).css("word-spacing").substr(-2)=="px"){var d=parseFloat($(h).css("word-spacing"))}else{var d=0}}var g=true;var f=this;$.glue.slider(i,function(e,k){var j=d+k/6;$(h).css("word-spacing",(j/c)+"em");if(e!=0||k!=0){g=false}},function(e,j){if(g){$(h).css("word-spacing","");$.glue.backend({method:"glue.object_remove_attr",name:$(h).attr("id"),attr:"text-word-spacing"})}else{$.glue.object.save(h)}});return false});$.glue.contextmenu.register("text","text-word-spacing",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-align.png" alt="btn" title="change text alignment" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$(this).data("owner");var f=$(c).css("text-align");if(f=="center"){$(this).attr("title","change text alignment (center)")}else{if(f=="right"){$(this).attr("title","change text alignment (right)")}else{if(f=="justify"){$(this).attr("title","change text alignment (justify)")}else{$(this).attr("title","change text alignment (left)")}}}});$(b).bind("click",function(d){var c=$(this).data("owner");var f=$(c).css("text-align");if(f=="center"){$(c).css("text-align","right");$(this).attr("title","change text alignment (right)")}else{if(f=="right"){$(c).css("text-align","justify");$(this).attr("title","change text alignment (justify)")}else{if(f=="justify"){$(c).css("text-align","left");$(this).attr("title","change text alignment (left)")}else{$(c).css("text-align","center");$(this).attr("title","change text alignment (center)")}}}$.glue.object.save(c)});$.glue.contextmenu.register("text","text-align",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-padding.png" alt="btn" title="change padding, click to reset to default one" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$(this).data("owner");$(this).attr("title","change padding ("+$(c).css("padding-left")+", "+$(c).css("padding-top")+"), click to reset to default one")});$(b).bind("mousedown",function(j){var i=$(this).data("owner");var d=parseInt($(i).css("padding-left"));if(isNaN(d)){d=0}var g=$(i).width();var c=parseInt($(i).css("padding-top"));if(isNaN(c)){c=0}var k=$(i).height();var h=true;var f=this;$.glue.slider(j,function(l,p,m){var o=Math.floor(d+l/6);if(o<0){o=0}var n=Math.floor(c+p/6);if(n<0){n=0}if(m.shiftKey){if(o<n){o=n}else{if(n<o){n=o}}}$(i).css("padding-left",o+"px");$(i).css("padding-right",o+"px");$(i).css("width",(g+2*d-2*o)+"px");$(i).css("padding-top",n+"px");$(i).css("padding-bottom",n+"px");$(i).css("height",(k+2*c-2*n)+"px");$(f).attr("title","change padding ("+o+"px, "+n+"px), click to reset to default one");if(l!=0||p!=0){h=false}},function(e,n){if(h){var m=parseInt($(i).css("padding-left"));if(!isNaN(m)){$(i).css("width",($(i).width()+2*m)+"px")}var l=parseInt($(i).css("padding-top"));if(!isNaN(l)){$(i).css("height",($(i).height()+2*l)+"px")}$(i).css("padding-left","");$(i).css("padding-right","");$(i).css("padding-top","");$(i).css("padding-bottom","");$(f).attr("title","change padding ("+$(i).css("padding-left")+", "+$(i).css("padding-top")+"), click to reset to default one")}$.glue.object.save(i)});return false});$.glue.contextmenu.register("text","text-text-padding",b);$.glue.object.register_alter_pre_save("text",function(c,d){$(c).children(".glue-text-input").css("background-image","");$(c).children(".glue-text-input").remove();$(c).children(".glue-text-render").remove()})});
